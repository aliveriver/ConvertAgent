# ConvertAgent 模板功能使用指南

## 🎯 功能概述

模板模式允许你使用一个现有的文档作为模板，然后将另一个文档的内容按照模板的格式进行重新排版和输出。

## 📋 使用流程

### 1. 准备模板文件

模板文件定义了输出文档的**结构和样式**：

**支持的模板格式**：
- `.docx` - Word 文档（标题样式、字体、颜色等）
- `.md` - Markdown 文件（标题层级、列表格式等）
- `.tex` - LaTeX 文件（章节结构、排版格式等）

**模板示例**：

```
报告模板.docx:
# 大标题（样式：Heading 1，蓝色，加粗）
## 小标题（样式：Heading 2，灰色）
正文段落（样式：Normal，字体 12pt）
[图片占位]
```

### 2. 准备内容文件

内容文件包含实际的**文本和图片**：

**支持的内容格式**：
- `.docx` - Word 文档
- `.pdf` - PDF 文件
- `.md` - Markdown 文件

**内容示例**：

```
内容.docx:
这是我的项目
项目背景
本项目旨在...
[实际的项目截图.png]
```

### 3. 选择输出格式

AI 会将内容按照模板格式输出为：
- **Word** (`.docx`) - 适合打印、分享
- **Markdown** (`.md`) - 适合网页、博客
- **LaTeX** (`.tex`) - 适合学术论文

### 4. 添加额外要求（可选）

你可以添加额外的处理指令：
- "保持所有图片并居中"
- "将代码块使用等宽字体"
- "添加页码和页眉"
- "调整行距为 1.5 倍"

## 💡 使用场景

### 场景 1：简历格式转换
- **模板**：一份精美的简历模板（Word）
- **内容**：你的个人信息和工作经历（纯文本）
- **输出**：格式化的个人简历（Word/PDF）

### 场景 2：论文重排版
- **模板**：学校的论文格式要求（LaTeX）
- **内容**：你写的论文内容（Word）
- **输出**：符合学校要求的论文（LaTeX/PDF）

### 场景 3：博客文章生成
- **模板**：你的博客样式（Markdown）
- **内容**：一篇文章草稿（Word）
- **输出**：可直接发布的博客文章（Markdown）

### 场景 4：报告统一格式
- **模板**：公司的报告模板（Word）
- **内容**：多个项目的报告内容
- **输出**：格式统一的报告（Word）

## 🔧 工作原理

```
模板文件 ─→ [AI 分析结构]
                ↓
            提取：标题层级
                 段落样式
                 字体格式
                 图片位置
                ↓
内容文件 ─→ [AI 提取内容]
                ↓
            提取：文本内容
                 图片资源
                 数据信息
                ↓
         [AI 智能映射]
                ↓
            将内容按照模板
            结构进行排版
                ↓
         生成目标格式文档
```

## ⚙️ API 接口说明

### 端点：`POST /api/process-with-template`

**请求参数**：
```javascript
{
  template_file: File,          // 模板文件
  content_file: File,           // 内容文件
  output_format: "word" | "markdown" | "latex",
  additional_instruction: string  // 可选
}
```

**响应**：
```javascript
{
  success: true,
  message: "模板处理完成",
  result: {
    output: "处理结果描述",
    steps: 5,  // Agent 执行的步骤数
    template: "模板文件路径",
    content: "内容文件路径",
    format: "输出格式"
  }
}
```

## 🛠️ 可用工具

Agent 在处理模板时可以使用以下工具：

1. **extract_document_structure** - 分析模板结构
2. **read_document/read_markdown/read_latex** - 读取内容
3. **extract_images_from_document** - 提取图片
4. **apply_template_structure** - 应用模板到内容
5. **write_document/write_markdown/write_latex** - 生成输出
6. **convert_format** - 格式转换

## 📝 注意事项

1. **文件大小**：建议单个文件不超过 10MB
2. **图片处理**：图片会被提取并重新插入到输出文档
3. **格式兼容**：不同格式之间的转换可能会丢失某些高级格式
4. **处理时间**：复杂文档可能需要 30-60 秒
5. **模型限制**：依赖 GPT-4 的理解能力，复杂的版式可能需要多次调整

## 🚀 最佳实践

1. **模板简洁明了**：使用清晰的标题层级和样式
2. **内容结构化**：将内容组织成段落和章节
3. **图片标注**：在内容中清楚标注图片位置
4. **测试迭代**：先用简单文档测试，再处理复杂内容
5. **额外指令明确**：清楚描述你想要的特殊处理

## 🐛 故障排除

**问题：生成的文档格式不符合预期**
- 解决：在"额外要求"中详细描述你想要的格式

**问题：图片没有正确插入**
- 解决：确保内容文件中的图片路径正确，或在指令中说明图片处理方式

**问题：处理时间过长**
- 解决：减小文件大小，或将大文档拆分成多个小文档处理

**问题：Agent 报错**
- 解决：检查文件格式是否正确，查看错误信息并调整输入
